<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Publications – Udaya Wijenayake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <header>
    <div class="container header-content">
      
      <div class="header-text-container">
        <h1>Udaya Wijenayake</h1>
        <p class="subtitle">
          Senior Lecturer, Department of Computer Engineering,<br />
          University of Sri Jayewardenepura, Sri Lanka
        </p>
        <p class="tags">
          Computer Vision · Image Processing · Machine Learning · Human–Computer Interaction
        </p>
        <div class="links">
          <a href="https://scholar.google.com/citations?hl=en&user=zZNLOAwAAAAJ" target="_blank">Google Scholar</a>
          <a href="https://www.researchgate.net/profile/Udaya-Wijenayake" target="_blank">ResearchGate</a>
          <a href="https://www.linkedin.com/in/udaya-wijenayake-395749144/" target="_blank">LinkedIn</a>
          <a href="https://github.com/udayawijenayake" target="_blank">GitHub</a>
          <a href="assets/docs/Udaya_Wijenayake_CV.pdf" target="_blank">CV (PDF)</a>
        </div>
      </div>
      
      <div class="profile-pic-container"> 
        <img src="assets/img/profile.jpg" alt="Udaya Wijenayake" class="profile-pic" />
      </div>
    </div>

    <nav>
      <div class="container nav-links">
        <a href="index.html">Home</a>
        <a href="research.html">Research</a>
        <a href="publications.html" class="active-link">Publications</a> <a href="services.html">Services</a>
        <a href="teaching.html">Teaching</a>
        <a href="blogs.html">Blogs</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <section>
      <h2>Publications</h2>
      <p>A list of my publications compiled from BibTeX. You can view my complete profile on <a href="https://scholar.google.com/citations?hl=en&user=zZNLOAwAAAAJ" target="_blank">Google Scholar</a>.</p>
    </section>

    <section id="publications-root">
      <p>Loading publications…</p>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>
        © <span data-year></span>
        Udaya Wijenayake · Department of Computer Engineering, University of Sri Jayewardenepura
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@jonny/bibtex-parse-js@0.0.26/bibtexParse.js"></script>

  <script>
    // Set footer year using data-year attribute
    document.querySelector("[data-year]").textContent = new Date().getFullYear();

    // Human-friendly labels for BibTeX entry types
    const TYPE_LABELS = {
      article: "Journal Articles",
      inproceedings: "Conference Papers",
      incollection: "Book Chapters",
      proceedings: "Edited Proceedings",
      book: "Books",
      phdthesis: "PhD Theses",
      mastersthesis: "Master's Theses",
      techreport: "Technical Reports",
      misc: "Other Publications"
    };

    // Order in which sections appear
    const TYPE_ORDER = [
      "article",
      "inproceedings",
      "incollection",
      "proceedings",
      "book",
      "phdthesis",
      "mastersthesis",
      "techreport",
      "misc"
    ];

    async function loadPublications() {
      const root = document.getElementById("publications-root");

      try {
        // NOTE: Ensure publications.bib file exists in the correct location
        const response = await fetch("publications.bib");
        if (!response.ok) {
          root.innerHTML = "<p>Could not load <code>publications.bib</code>. Ensure the file exists and is accessible.</p>";
          return;
        }

        const bibtexText = await response.text();
        const entries = bibtexParse.toJSON(bibtexText);

        // Grouped structure: { type: { year: [entries...] } }
        const grouped = {};

        entries.forEach((entry) => {
          const type = (entry.entryType || "misc").toLowerCase();

          // Normalize tag keys to lowercase (handles AUTHOR vs author, etc.)
          const rawTags = entry.entryTags || {};
          const tags = {};
          Object.keys(rawTags).forEach((key) => {
            tags[key.toLowerCase()] = rawTags[key];
          });

          const year = tags.year || "No year";

          if (!grouped[type]) grouped[type] = {};
          if (!grouped[type][year]) grouped[type][year] = [];

          // Store normalized tags on the entry for later use
          entry._normTags = tags;
          grouped[type][year].push(entry);
        });

        // Build HTML
        let html = "";

        TYPE_ORDER.forEach((type) => {
          if (!grouped[type]) return;

          const typeLabel = TYPE_LABELS[type] || type;
          html += `<section class="pub-section"><h2>${typeLabel}</h2>`;

          // Sort years descending (so 2025, 2024, 2023, …)
          const years = Object.keys(grouped[type]).sort((a, b) => {
            const na = parseInt(a, 10);
            const nb = parseInt(b, 10);
            if (isNaN(na) && isNaN(nb)) return a.localeCompare(b);
            if (isNaN(na)) return 1;
            if (isNaN(nb)) return -1;
            return nb - na;
          });

          years.forEach((year) => {
            html += `<h3>${year}</h3><ol class="pub-list">`;

            grouped[type][year].forEach((entry) => {
              const t = entry._normTags || {};
              const authors = t.author || "";
              const title = t.title || "";
              const journalOrBook =
                t.journal || t.booktitle || t.school || t.howpublished || "";
              const doi = t.doi || "";
              const url = t.url || "";
              const abstractUrl = t.abstracturl || ""; // Added abstract URL

              let venueStr = journalOrBook ? `<span class="pub-venue">${journalOrBook}</span>` : "";
              let detailsParts = [];

              if (t.volume) detailsParts.push("vol. " + t.volume);
              if (t.number) detailsParts.push("no. " + t.number);
              if (t.pages) detailsParts.push("pp. " + t.pages);

              // Handle MDPI-style article numbers when pages are absent
              if (t["article-number"] && !t.pages) {
                detailsParts.push("Article " + t["article-number"]);
              }

              const detailsStr = detailsParts.join(", ");
              const links = [];

              // Link Priority: DOI > URL
              if (doi) {
                links.push(`<a href="https://doi.org/${doi}" target="_blank">DOI</a>`);
              } else if (url) {
                links.push(`<a href="${url}" target="_blank">Link</a>`);
              }
              if (abstractUrl) {
                links.push(`<a href="${abstractUrl}" target="_blank">Abstract</a>`);
              }
              // Add other links (e.g., PDF) if they were in the BibTeX entry.

              html += "<li>";

              // 1. Authors
              if (authors) {
                html += `<span class="pub-authors">${authors}</span>, `;
              }
              // 2. Title
              if (title) {
                html += `<span class="pub-title">“${title}”</span>`;
              }
              // 3. Venue
              if (venueStr) {
                html += `, ${venueStr}`;
              }
              // 4. Details (Vol, Pages, etc.)
              if (detailsStr) {
                html += `, <span class="pub-details">${detailsStr}</span>`;
              }
              // 5. Year (Already in the <h3>, but sometimes added for full citation)
              html += ` (${year}).`;


              // 6. Links (Separated at the end of the line for clarity)
              if (links.length > 0) {
                 html += ` <span class="pub-links"> | ${links.join(" | ")}</span>`;
              }

              html += "</li>";
            });

            html += "</ol>";
          });

          html += "</section>";
        });

        if (!html) {
          html = "<p>No publications found in <code>publications.bib</code>.</p>";
        }

        root.innerHTML = html;
      } catch (err) {
        console.error(err);
        root.innerHTML = "<p>Error while loading publications. Check your console for details.</p>";
      }
    }

    loadPublications();
  </script>
</body>
</html>

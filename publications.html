<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Publications – Udaya Wijenayake</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <header>
    <div class="container header-content">
      <div>
        <h1>Udaya Wijenayake</h1>
        <p class="subtitle">
          Senior Lecturer, Department of Computer Engineering,<br />
          University of Sri Jayewardenepura, Sri Lanka
        </p>
        <p class="tags">
          Computer Vision · Image Processing · Machine Learning · Human–Computer Interaction
        </p>
        <div class="links">
          <a href="index.html">Home</a>
          <a href="assets/docs/Udaya_Wijenayake_CV.pdf" target="_blank">CV (PDF)</a>
        </div>
      </div>
      <img src="assets/img/profile.jpg" alt="Udaya Wijenayake" class="profile-pic" />
    </div>

    <nav>
      <div class="container">
        <a href="index.html">Home</a>
        <a href="research.html">Research</a>
        <a href="publications.html">Publications</a>
        <a href="services.html">Services</a>
        <a href="teaching.html">Teaching</a>
        <a href="blogs.html">Blogs</a>
        <a href="contact.html">Contact</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <section>
      <h2>Publications</h2>
      <p>
        This list is generated automatically from a BibTeX file
        (<code>publications.bib</code>) in the repository.
      </p>
    </section>

    <!-- Where the script will inject content -->
    <section id="publications-root">
      <p>Loading publications…</p>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>© <span id="year"></span> Udaya Wijenayake · Department of Computer Engineering, University of Sri Jayewardenepura</p>
    </div>
  </footer>

  <!-- 1) BibTeX parser library from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@jonny/bibtex-parse-js@0.0.26/bibtexParse.js"></script>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // Map BibTeX entry types to human-readable section names
    const TYPE_LABELS = {
      article: "Journal Articles",
      inproceedings: "Conference Papers",
      incollection: "Book Chapters",
      book: "Books",
      phdthesis: "PhD Theses",
      mastersthesis: "Master's Theses",
      misc: "Other Publications"
    };

    const TYPE_ORDER = [
      "article",
      "inproceedings",
      "incollection",
      "book",
      "phdthesis",
      "mastersthesis",
      "misc"
    ];

    async function loadPublications() {
      const root = document.getElementById("publications-root");

      try {
        const response = await fetch("publications.bib");
        if (!response.ok) {
          root.innerHTML = "<p>Could not load publications.bib.</p>";
          return;
        }

        const bibtexText = await response.text();
        const entries = bibtexParse.toJSON(bibtexText);

        // Group by type and year
        const grouped = {}; // { type: { year: [entries...] } }

        entries.forEach((entry) => {
          const type = (entry.entryType || "misc").toLowerCase();
          const tags = entry.entryTags || {};
          const year = tags.year || "No year";

          if (!grouped[type]) grouped[type] = {};
          if (!grouped[type][year]) grouped[type][year] = [];
          grouped[type][year].push(entry);
        });

        // Build HTML
        let html = "";

        TYPE_ORDER.forEach((type) => {
          if (!grouped[type]) return;

          const typeLabel = TYPE_LABELS[type] || type;

          html += `<section class="pub-section"><h2>${typeLabel}</h2>`;

          // Sort years descending (so latest first)
          const years = Object.keys(grouped[type]).sort((a, b) => {
            // Put non-numeric years at the end
            const na = parseInt(a, 10);
            const nb = parseInt(b, 10);
            if (isNaN(na) && isNaN(nb)) return a.localeCompare(b);
            if (isNaN(na)) return 1;
            if (isNaN(nb)) return -1;
            return nb - na;
          });

          years.forEach((year) => {
            html += `<h3>${year}</h3><ol class="pub-list">`;

            grouped[type][year].forEach((entry) => {
              const t = entry.entryTags || {};
              const authors = t.author || "";
              const title = t.title || "";
              const journalOrBook =
                t.journal || t.booktitle || t.school || t.howpublished || "";
              const doi = t.doi || "";
              const url = t.url || "";

              let venueStr = journalOrBook ? `<em>${journalOrBook}</em>` : "";
              let detailsParts = [];

              if (t.volume) detailsParts.push("vol. " + t.volume);
              if (t.number) detailsParts.push("no. " + t.number);
              if (t.pages) detailsParts.push("pp. " + t.pages);

              const detailsStr = detailsParts.join(", ");

              html += "<li>";

              if (authors) {
                html += `<span class="pub-authors">${authors}</span>, `;
              }
              if (title) {
                html += `<span class="pub-title">“${title}”</span>`;
              }
              if (venueStr) {
                html += `, <span class="pub-venue">${venueStr}</span>`;
              }
              if (detailsStr) {
                html += `, <span class="pub-details">${detailsStr}</span>`;
              }
              if (doi) {
                html += `, <a href="https://doi.org/${doi}" target="_blank">DOI</a>`;
              } else if (url) {
                html += `, <a href="${url}" target="_blank">Link</a>`;
              }

              html += "</li>";
            });

            html += "</ol>";
          });

          html += "</section>";
        });

        if (!html) {
          html = "<p>No publications found in publications.bib.</p>";
        }

        root.innerHTML = html;
      } catch (err) {
        console.error(err);
        root.innerHTML = "<p>Error while loading publications.</p>";
      }
    }

    loadPublications();
  </script>
</body>
</html>
